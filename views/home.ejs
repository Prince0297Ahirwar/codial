<h1>Codial / <%=title%></h1>

<section id = "feed-post">
    <%if(locals.user){%>
    <form action="/posts/create" method="POST" id="new-post-form">
        <textarea name="content"  cols="30" rows="10" placeholder="type here" required></textarea>
        <input type="submit" value="post">
    </form>
    <%}%>
    <div id="post-list-container">
        <ul>
            <%for(let post of posts){%>
                <p>
                    <li>
                        <%if(locals.user && locals.user.id == post.user.id){%>
                            <small>
                                <a href="/posts/destroy/<%=post.id%>">X</a>
                            </small>
                        <%}%>
                        <%=post.content%>
                        <br>
                        <small>
                            <%=post.user.name%>
                        </small>
                    </li>

                </p> 
                <div class ="post-comments">
                    <%if (locals.user){%>
                        <form action="/comments/create" method="POST">
                            <input type="text" name ="content" placeholder="Type here to add comment" required>
                            <input type="hidden" name = "post" value="<%=post._id%>">
                            <input type="submit" value="post">
                        </form>    
                    <%}%>
                    <div class ="post-comments-list">
                        <ul id="post-comments-<%=post._id%>">
                            <% for(let comment of post.comments){%>

                                
                            <li>
                                <%if(locals.user && locals.user.id == comment.user.id){%>
                                    <small>
                                        <a href="/comments/destroy/<%=comment.id%>">X</a>
                                    </small>
                                <%}%>

                                <p>
                                    <%=comment.content%>
                                    <br>
                                    <small>
                                        <%=comment.user.name%>
                                    </small>
                                    
                                </p>
                            </li>

                                <%}%>
                        </ul>
                    </div>
                </div>   

            <%}%>
        </ul>
    </div>
</section>